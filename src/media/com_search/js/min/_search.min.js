/*! anahita 06-06-2021 */

!function(o,t,e){"use strict";o.widget("anahita.search",{options:{searchForm:'form[data-trigger="SearchRequest"]',term:"input[name=term]",sortOption:'select[data-trigger="SortOption"]',commentOption:'input[data-trigger="SearchOption"]',nearbyOption:'input[data-trigger="SearchNearby"]',coordLatOption:'input[data-trigger="CoordLat"]',coordLngOption:'input[data-trigger="CoordLng"]',rangeOption:'select[data-trigger="SearchRange"]',scope:'[data-trigger="ChangeScope"]',results:"#an-search-results",searchScopes:".search-scopes"},_create:function(){this.form=o(this.options.searchForm),this.term=this.form.find(this.options.term),this.sort=o(this.options.sortOption),this.comments=o(this.options.commentOption),this.nearby=o(this.options.nearbyOption),this.range=o(this.options.rangeOption),this.scope=o(this.options.scope),this.coordLng=o(this.options.coordLngOption),this.coordLat=o(this.options.coordLatOption),this.searchOptions={scope:"all",sort:"recent",search_comments:!1,coord_lat:0,coord_lng:0,search_range:null},this._on(this.term,{change:function(t){t.preventDefault(),this.submit(this.form)}}),this._on(this.scope,{click:function(t){t.preventDefault(),o(this.options.searchScopes).find("li").removeClass("active"),o(t.target).parent().addClass("active"),this.submit(o(t.target))}}),this._on(this.sort,{change:function(t){t.preventDefault(),this.submit(o(t.target))}}),this._on(this.comments,{change:function(t){t.preventDefault(),this.submit(o(t.target))}}),this._on(this.form,{SearchNearby:function(t){this.range.prop("disabled",!1),this.submit(this.nearby)}}),this._on(this.nearby,{change:function(t){t.preventDefault(),""==o(t.target).val()&&(this.range.prop("disabled",!0),this.sort.val("relevant"),this.searchOptions.search_range=null,this.searchOptions.coord_lng=null,this.searchOptions.coord_lat=null,this.searchOptions.sort="relevant",this.submit(this.form))}}),this._on(this.range,{change:function(t){t.preventDefault(),this.submit(o(t.target))}})},submit:function(e){var i=this;this.searchOptions=o.extend(this.searchOptions,{term:this.term.val(),sort:this.sort.val(),scope:e.data("scope"),search_comments:this.comments.is(":checked"),search_range:this.range.val()?this.range.val():null,coord_lng:this.coordLng.val()?this.coordLng.val():null,coord_lat:this.coordLat.val()?this.coordLat.val():null}),o.ajax({url:this.form.attr("action"),data:this.searchOptions,beforeSend:function(){e.fadeTo("fast",.3).addClass("uiActivityIndicator")},success:function(t,e,s){t=o(t),o(i.options.results).data("fetched-items",t.filter(".an-entity")),o(i.element).trigger("entities-reset-render")},complete:function(){e.fadeTo("fast",1).removeClass("uiActivityIndicator");var t=i.form.attr("action")+"?"+o.param(i.searchOptions);o(i.element).data("newUrl",t).trigger("urlChange")}})}});o("#an-search-results").search()}(jQuery,window,document);