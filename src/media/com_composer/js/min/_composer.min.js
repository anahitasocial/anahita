/*! anahita 10-08-2020 */

!function(i,t,a){"use strict";if(i.widget("anahita.composerform",{options:{stories:"#an-stories",form:".composer-form"},_create:function(){var o=i(this.element);if("multipart/form-data"===o.attr("enctype")){var n=new FormData(o[0]);n.append("composed",!0),n.append("format","raw"),this._on(o,{submit:function(t){if(t.preventDefault(),o.trigger("beforeSubmit"),i.each(o.serializeArray(),function(t,e){n.append(e.name,e.value)}),i.each(o.find(":file")[0].files,function(t,e){n.append("file",e)}),i(a).data("browser_coords")){var e=i(a).data("browser_coords");n.append("geoLatitude",e.latitude),n.append("geoLongitude",e.longitude)}i.ajax({url:o.attr("action"),processData:!1,contentType:!1,data:n,method:"post",beforeSend:function(){o.find(":submit").button("loading")},success:function(t){i(this.element).trigger("reset"),i(this.options.stories).prepend(i(t).fadeIn("slow"))}.bind(this),complete:function(){o.find(":submit").button("reset")}})}})}else this._on(o,{submit:function(t){if(t.preventDefault(),o.trigger("beforeSubmit"),i(a).data("browser_coords")){var e=i(a).data("browser_coords");o.append('<input type="hidden" name="geoLatitude" value="'+e.latitude+'" />'),o.append('<input type="hidden" name="geoLongitude" value="'+e.longitude+'" />')}i.ajax({url:o.attr("action"),data:o.serialize()+"&composed=1",method:"post",beforeSend:function(){o.find(":submit").button("loading")},success:function(t){i(this.element).trigger("reset"),i(this.options.stories).find(".span12").prepend(i(t).fadeIn("slow"))}.bind(this),complete:function(){o.find(":submit").button("reset")}})}})}}),i.widget("anahita.composer",{options:{composerTab:".tab-content-item",formPlaceholder:"a.form-placeholder",composerForm:".composer-form",composerMenu:"#composer-menu li",composerMenuTitle:".composer-button-title"},_create:function(){this.firstTime=!0,this.currentTabIndex=0,this.tabs=this.element.find(this.options.composerTab);var o=this.options.formPlaceholder;this.tabs.each(function(t,e){i(e).data("placeholder",i(e).find(o))}),this._on(i(this.options.composerMenu),{click:function(t){t.preventDefault();var e=i(t.delegateTarget);i(this.options.composerMenuTitle).text(e.find("a").attr("title")),this.selectTab(e.index())}}),this._on(i(this.options.composerTab),{elem:i(this.options.formPlaceholder),click:function(t){t.stopPropagation(),this.showTabContent(i(t.delegateTarget).index())}}),this._on({elem:i(this),clickoutside:function(t){this.hideTabContent(this.currentTabIndex)}}),this.selectTab(this.currentTabIndex)},selectTab:function(t){var e=this;i(this.tabs[this.currentTabIndex]).hide(),this.currentTabIndex=t;var o=i(this.tabs[this.currentTabIndex]);return o.data("content")||i.ajax({method:"get",url:o.data("url"),beforeSend:function(){e.firstTime||e.element.fadeTo("fast",.8).addClass("uiActivityIndicator")},success:function(t){o.append(t),i(o).find("form.composer-form").composerform(),o.data("content",o.find(e.options.composerForm)),e.firstTime&&(e.firstTime=!1,e.hideTabContent(e.currentTabIndex))},complete:function(){e.element.fadeTo("fast",1).removeClass("uiActivityIndicator")}}),this.firstTime||this.showTabContent(this.currentTabIndex),o.fadeIn(),this},showTabContent:function(t){var e=i(this.tabs[t]);i(e.data("placeholder")).hide(),i(e.data("content")).fadeIn()},hideTabContent:function(t){var e=i(this.tabs[t]);i(e.data("content")).hide(),i(e.data("placeholder")).fadeIn()}}),i("[data-behavior='Composer']").length){var e=i("[data-behavior='Composer']").composer();e.hide();var o=i("ul.streams");o.length&&o.on("click","li",function(t){"stories"==i(this).data("stream")?e.fadeIn():e.fadeOut()})}i(a).ajaxSuccess(function(t,e,o){var n=i("a.connect-link");n.length&&!n.is(":data('tooltip')")&&i(n).tooltip({placement:"top",animation:!0,trigger:"hover"})})}(jQuery,window,document);