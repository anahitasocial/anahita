/*! anahita 23-09-2019 */

!function(i){"use strict";i.widget("anahita.setOrganizer",{options:{selector:"#photo-selector-list",url:i("#set-photos").data("url"),photos:i("#set-photos").find(".media-grid"),thumbnail:".thumbnail-wrapper",cover:"#set-cover-wrapper",form:"#set-form"},_create:function(){var o=this;this.element.hide(),this.selector=null,this.photoList=null,this._on("body",{'click a[data-trigger="Organize"]':function(t){t.preventDefault(),o.open(t.currentTarget.href)}}),this._on(this.element,{'click a[data-trigger="ClosePhotoSelector"]':function(t){t.preventDefault(),o.close()}}),this._on(this.options.form,{submit:function(t){this._beforeAdd()}})},open:function(t){var o=this;i.get(t,function(t){o.element.html(t).slideDown(),o.selector=i(o.options.selector).sortable({connectWith:i(o.options.photos),scroll:!1}),o.photoList=i(o.options.photos).sortable({connectWith:i(o.options.selector),cancel:".cover",update:function(){o.options.url&&o._edit()}}),o.photoList.parent().addClass("an-highlight")})},close:function(){var t=this;this.element.slideUp("normal",function(){t.selector.sortable("destroy"),t.photoList.sortable("destroy"),t.photoList.parent().removeClass("an-highlight"),t.element.empty()})},_beforeAdd:function(){var e=this,t=e.photoList.find(e.options.thumbnail);0==t.length&&event.preventDefault(),i.each(t,function(t,o){i(e.options.form).append('<input type="hidden" name="photo_id[]" value='+i(o).attr("photo")+" />")})},_edit:function(){var o=this,t=this.photoList.find(this.options.thumbnail),e="action=updatephotos";i.each(t,function(t,o){e+="&photo_id[]="+i(o).attr("photo")}),i.ajax({method:"post",url:this.options.url,data:e,success:function(){var t=i(o.options.photos).find(o.options.thumbnail);t.removeClass("cover"),t.first().addClass("cover"),o._refreshCover()}})},_refreshCover:function(){var o=this;i.ajax({method:"get",url:this.options.url,data:"layout=cover",success:function(t){i(o.options.cover).html(t)}})}}),i("#photo-selector").setOrganizer()}(jQuery,window);