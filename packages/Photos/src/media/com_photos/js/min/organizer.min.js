/*! anahita 20-06-2015 */
!function(a,b){"use strict";a.widget("anahita.setOrganizer",{options:{selector:"#photo-selector-list",url:a("#set-photos").data("url"),photos:a("#set-photos").find(".media-grid"),thumbnail:".thumbnail-wrapper",cover:"#set-cover-wrapper",form:"#set-form"},_create:function(){var a=this;this.element.hide(),this.selector=null,this.photoList=null,this._on("body",{'click a[data-trigger="Organize"]':function(b){b.preventDefault(),a.open(b.currentTarget.href)}}),this._on(this.element,{'click a[data-trigger="ClosePhotoSelector"]':function(b){b.preventDefault(),a.close()}}),this._on(this.options.form,{submit:function(a){this._beforeAdd()}})},open:function(b){var c=this;a.get(b,function(b){c.element.html(b).slideDown(),c.selector=a(c.options.selector).sortable({connectWith:a(c.options.photos),scroll:!1}),c.photoList=a(c.options.photos).sortable({connectWith:a(c.options.selector),cancel:".cover",update:function(){c.options.url&&c._edit()}}),c.photoList.parent().addClass("an-highlight")})},close:function(){var a=this;this.element.slideUp("normal",function(){a.selector.sortable("destroy"),a.photoList.sortable("destroy"),a.photoList.parent().removeClass("an-highlight"),a.element.empty()})},_beforeAdd:function(){var b=this,c=b.photoList.find(b.options.thumbnail);0==c.length&&event.preventDefault(),a.each(c,function(c,d){a(b.options.form).append('<input type="hidden" name="photo_id[]" value='+a(d).attr("photo")+" />")})},_edit:function(){var b=this,c=this.photoList.find(this.options.thumbnail),d="action=updatephotos";a.each(c,function(b,c){d+="&photo_id[]="+a(c).attr("photo")}),a.ajax({method:"post",url:this.options.url,data:d,success:function(){var c=a(b.options.photos).find(b.options.thumbnail);c.removeClass("cover"),c.first().addClass("cover"),b._refreshCover()}})},_refreshCover:function(){var b=this;a.ajax({method:"get",url:this.options.url,data:"layout=cover",success:function(c){a(b.options.cover).html(c)}})}}),a("#photo-selector").setOrganizer()}(jQuery,window);