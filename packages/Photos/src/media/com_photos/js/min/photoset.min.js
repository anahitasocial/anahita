/*! anahita 10-08-2020 */

!function(n,t){"use strict";n.widget("anahita.photoSetAssignment",{_create:function(){var e=this;this.photoId=this.element.data("photo"),this.url=this.element.data("url"),this._on('[data-action="OpenSetSelector"]',{click:function(t){t.preventDefault(),e._open(t.target.href)}}),this._on(this.element,{'click [data-action="CloseSetSelector"]':function(t){t.preventDefault(),e._close(e.url)}});var t=this.element.find("form");this._on(this.element,{elem:t,submit:function(t){t.preventDefault(),n.ajax({method:"post",url:n(t.target).attr("action"),data:n(t.target).serialize(),success:function(t){e.element.find(".an-entities").prepend(t)}})}}),this._on(this.element,{'click [data-action="addphoto"], [data-action="removephoto"]':function(t){t.preventDefault(),this._changeAssignment(n(t.currentTarget))}})},_open:function(t){var e=this;n.ajax({method:"get",url:t+"&photo_id"+this.photoId,beforeSend:function(){e.element.slideUp()},success:function(t){e.element.html(t)},complete:function(){e.element.slideDown()}})},_close:function(t){var e=this;n.ajax({method:"get",url:t+"&photo_id="+this.photoId,beforeSend:function(){e.element.slideUp()},success:function(t){e.element.html(t)},complete:function(){e.element.slideDown()}})},_changeAssignment:function(t){var e=t.data("action");n.ajax({method:"post",url:t.data("url"),data:{photo_id:this.photoId,action:e},beforeSend:function(){t.fadeTo("fast",.7).addClass("uiActivityIndicator")},success:function(){t.fadeTo("fast",1).removeClass("uiActivityIndicator"),"addphoto"==e?(t.data("data-action","removephoto"),t.addClass("an-highlight")):(t.data("data-action","addphoto"),t.removeClass("an-highlight"))}})}}),n("#sets-wrapper").photoSetAssignment()}(jQuery,window);