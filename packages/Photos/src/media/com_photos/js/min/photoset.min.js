/*! anahita 20-06-2015 */
!function(a,b){"use strict";a.widget("anahita.photoSetAssignment",{_create:function(){var b=this;this.photoId=this.element.data("photo"),this.url=this.element.data("url"),this._on('[data-action="OpenSetSelector"]',{click:function(a){a.preventDefault(),b._open(a.target.href)}}),this._on(this.element,{'click [data-action="CloseSetSelector"]':function(a){a.preventDefault(),b._close(b.url)}});var c=this.element.find("form");this._on(this.element,{elem:c,submit:function(c){c.preventDefault(),a.ajax({method:"post",url:a(c.target).attr("action"),data:a(c.target).serialize(),success:function(a){b.element.find(".an-entities").prepend(a)}})}}),this._on(this.element,{'click [data-action="addphoto"], [data-action="removephoto"]':function(b){b.preventDefault(),this._changeAssignment(a(b.currentTarget))}})},_open:function(b){var c=this;a.ajax({method:"get",url:b+"&photo_id"+this.photoId,beforeSend:function(){c.element.slideUp()},success:function(a){c.element.html(a)},complete:function(){c.element.slideDown()}})},_close:function(b){var c=this;a.ajax({method:"get",url:b+"&photo_id="+this.photoId,beforeSend:function(){c.element.slideUp()},success:function(a){c.element.html(a)},complete:function(){c.element.slideDown()}})},_changeAssignment:function(b){var c=b.data("action");a.ajax({method:"post",url:b.data("url"),data:{photo_id:this.photoId,action:c},beforeSend:function(){b.fadeTo("fast",.7).addClass("uiActivityIndicator")},success:function(){b.fadeTo("fast",1).removeClass("uiActivityIndicator"),"addphoto"==c?(b.data("data-action","removephoto"),b.addClass("an-highlight")):(b.data("data-action","addphoto"),b.removeClass("an-highlight"))}})}}),a("#sets-wrapper").photoSetAssignment()}(jQuery,window);